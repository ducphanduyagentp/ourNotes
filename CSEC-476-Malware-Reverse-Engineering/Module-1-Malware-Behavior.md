# Malware Behavior

- Downloader: Fetch the actual malware from somewhere else.
- Launcher/loader: Usually self-contain the actual malware and just load it on the system.
- Backdoor:
- Reverse shell:
    - CreateProcess
    - STARTUPINFO struct
    - Multithreaded: 2 pipes, 2 threads
    - Network pipes vs sockets
        - *TODO* more research.
- RAT:
    - The infected hosts are servers.
    - Attackers are clients giving instructions to servers.
- Botnets: Infected hosts also
    - Botnets vs RATs:
        - Mass vs. targeted
        - Many vs. some
        - Botnets are used for attacks but RATs infect the actual victims.
- Credential Stealers.
    - SHA-256 is too fast so it's not used in password hashing? :o
- KeyLoggers
    - SetWindowsHookEx
    - GetAsyncKeyState vs GetKeyState

## Loading Libraries

- Static
- Dynamic
- Runtime

- msv1_0.dll
    - SAM hashes

## Persistence Mechanisms

- Registry key:
    - At boot: Run, RunOnce
        - HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run(Once)
        - HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run(Once)
    - Processes: AppInit_DLLs, dlls that will be loaded if user32.dll is loaded
        - HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows
    - Winlogon:
        - HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\
        - DLLs that handle events from winlogon.exe (logon, logoff, shutdown, lockscreen, etc.)
    - svchost dlls:
        - Group of services: HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Svchost
        - Services: HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\ServiceName

- Trojanized binaries
    - Hijack the DLLEntryPoint
- DLL Load-order hijack
    - Search order:
        - Directory of the program
        - Current directory
        - System directory (by GetSystemDirectory, Windows/System32)
        - 16-bit system directory (Windows/System)
        - Windows dir (Windows)
        - PATH environment variables
    - KnownDLLs registry key: DLL loading will be skipped
- Hooking:
    - IAT hooking: https://github.com/m0n0ph1/IAT-Hooking-Revisited
    - Inline hooking: 